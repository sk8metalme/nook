---
description: PHP開発のルールとベストプラクティス
globs:
  - "**/*.php"
  - "**/composer.json"
alwaysApply: false
---

# PHP開発ルール

## PHP設定
- PHP 8.2以降を対象とする
- strict_typesを常に宣言する
- 型ヒントと戻り値の型を使用する
- null合体演算子を活用する

## コーディング標準
- PSR-12コーディング標準に準拠する
- 意味のある変数名を使用する
- 関数は単一責任原則に従う
- 適切なエラーハンドリングを実装する

## フレームワーク・ツール
- Slim Framework 4.x（軽量API開発）
- 純粋PHP + Composerパッケージ
- PDOでデータベース抽象化（MySQL/Oracle対応）
- Monologでロギング実装
- PHPUnit + Phakeでテスト

## データベース
- MySQL 8.0
- Oracle Database 19c/21c
- PDOプリペアドステートメント必須
- トランザクション管理の徹底

## セキュリティ
- すべての入力を検証・フィルタリングする
- プリペアドステートメントを使用する
- XSS対策を実装する
- 適切なパスワードハッシュを使用する
- CSRFトークンの実装

## ベストプラクティス
- Composerで依存関係を管理する
- 名前空間を適切に使用する
- 例外処理を適切に実装する
- Monologで構造化ログを記録
- リポジトリパターンでデータアクセス層を抽象化

## テスト
- PHPUnit + Phakeでユニットテスト
- カバレッジ95%以上を維持する
- Phakeでモックオブジェクトを作成
- 統合テストも実装する
- テスト用DBはSQLite（:memory:）を使用